<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ph√¢n t√≠ch To√†n di·ªán H·ªá th·ªëng Quiz AI</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; margin: 40px; }
        h1, h2, h3 { color: #2c3e50; }
        pre { background: #f4f4f4; padding: 10px; border-radius: 5px; }
        ul { margin: 10px 0; }
        li { margin-bottom: 10px; }
    </style>
</head>
<body>
<h1>Ph√¢n t√≠ch To√†n di·ªán H·ªá th·ªëng Quiz AI</h1>
<p>T√†i li·ªáu n√†y m√¥ t·∫£ ki·∫øn tr√∫c c∆° s·ªü d·ªØ li·ªáu, c√°c API endpoints v√† ch·ª©c nƒÉng ch√≠nh, cung c·∫•p m·ªôt c√°i nh√¨n t·ªïng th·ªÉ v·ªÅ c√°ch h·ªá th·ªëng ho·∫°t ƒë·ªông.</p>

<ul>
    <li><a href="#erd">üìä S∆° ƒë·ªì Quan h·ªá</a></li>
    <li><a href="#tables">üìã Chi ti·∫øt B·∫£ng</a></li>
    <li><a href="#functions">üöÄ Ch·ª©c nƒÉng Ch√≠nh</a></li>
    <li><a href="#endpoints">üîå API Endpoints</a></li>
</ul>

<h2 id="erd">S∆° ƒë·ªì Quan h·ªá Th·ª±c th·ªÉ (ERD)</h2>
<p>D∆∞·ªõi ƒë√¢y l√† danh s√°ch c√°c m·ªëi quan h·ªá gi·ªØa c√°c b·∫£ng trong c∆° s·ªü d·ªØ li·ªáu, k√®m theo ƒë·ªãnh nghƒ©a chi ti·∫øt ƒë·ªÉ gi√∫p team hi·ªÉu r√µ c√°ch c√°c th·ª±c th·ªÉ li√™n k·∫øt v·ªõi nhau.</p>

<h3>M·ªëi Quan h·ªá Danh m·ª•c</h3>
<ul>
    <li><strong>Danh m·ª•c ch·ª©a b√†i ki·ªÉm tra (categories ||--o{ quizzes : "thu·ªôc"):</strong> M·ªôt danh m·ª•c c√≥ th·ªÉ ch·ª©a nhi·ªÅu b√†i ki·ªÉm tra, nh∆∞ng m·ªói b√†i ki·ªÉm tra ch·ªâ thu·ªôc v·ªÅ m·ªôt danh m·ª•c. Li√™n k·∫øt qua kh√≥a ngo·∫°i <code>category_id</code>.</li>
</ul>

<h3>M·ªëi Quan h·ªá C√¢u h·ªèi & ƒê√°p √°n</h3>
<ul>
    <li><strong>C√¢u h·ªèi c√≥ ƒë√°p √°n (questions ||--o{ answers : "c√≥"):</strong> M·ªôt c√¢u h·ªèi c√≥ th·ªÉ c√≥ nhi·ªÅu ƒë√°p √°n, nh∆∞ng m·ªói ƒë√°p √°n ch·ªâ thu·ªôc v·ªÅ m·ªôt c√¢u h·ªèi. Li√™n k·∫øt qua kh√≥a ngo·∫°i <code>question_id</code>.</li>
    <li><strong>Quiz ch·ª©a c√¢u h·ªèi (quizzes ||--o{ questions : "ch·ª©a"):</strong> M·ªôt b√†i ki·ªÉm tra c√≥ th·ªÉ ch·ª©a nhi·ªÅu c√¢u h·ªèi, nh∆∞ng m·ªói c√¢u h·ªèi ch·ªâ thu·ªôc v·ªÅ m·ªôt b√†i ki·ªÉm tra. Li√™n k·∫øt qua kh√≥a ngo·∫°i <code>quiz_id</code>.</li>
</ul>

<h3>S∆° ƒë·ªì Mermaid</h3>
<pre>
erDiagram
    users {
        int id PK
        varchar username
        varchar email
        varchar full_name
        varchar password_hash
        boolean is_active
        timestamp created_at
        timestamp updated_at
    }
    categories {
        int id PK
        varchar name
        text description
    }
    uploaded_files {
        int id PK
        int user_id FK
        varchar original_filename
        varchar stored_filename
        varchar file_path
        bigint file_size
        varchar file_type
        varchar mime_type
        timestamp upload_date
        boolean is_processed
        longtext processed_content
        boolean is_public
        boolean allow_reuse
        longtext content_embedding
        timestamp embedding_updated_at
    }
    quizzes {
        int id PK
        int creator_id FK
        int category_id FK
        varchar title
        text description
        text summary
        enum source_type
        int file_id FK
    }
    questions {
        int id PK
        int quiz_id FK
        text question_text
        enum question_type
        int points
        int order_index
        int time_limit
    }
    answers {
        int id PK
        int question_id FK
        text answer_text
        boolean is_correct
        int order_index
        timestamp created_at
    }
    users ||--o{ quizzes : "t·∫°o"
    users ||--o{ uploaded_files : "upload"
    categories ||--o{ quizzes : "thu·ªôc"
    quizzes ||--o{ questions : "ch·ª©a"
    questions ||--o{ answers : "c√≥"
    uploaded_files ||--o{ quizzes : "t·∫°o t·ª´"
    </pre>

<h2 id="tables">Chi ti·∫øt c√°c B·∫£ng v√† Tr∆∞·ªùng</h2>
<p>D∆∞·ªõi ƒë√¢y l√† m√¥ t·∫£ chi ti·∫øt v·ªÅ vai tr√≤ c·ªßa t·ª´ng b·∫£ng v√† c√°c tr∆∞·ªùng trong c∆° s·ªü d·ªØ li·ªáu c·ªßa h·ªá th·ªëng Quiz AI, gi√∫p team hi·ªÉu r√µ c√°ch d·ªØ li·ªáu ƒë∆∞·ª£c l∆∞u tr·ªØ v√† qu·∫£n l√Ω.</p>

<h3>üë• B·∫£ng users - Qu·∫£n l√Ω Ng∆∞·ªùi d√πng</h3>
<p>L∆∞u tr·ªØ th√¥ng tin t√†i kho·∫£n c·ªßa ng∆∞·ªùi d√πng, bao g·ªìm th√¥ng tin ƒëƒÉng nh·∫≠p v√† h·ªì s∆° c√° nh√¢n.</p>
<ul>
    <li><code>id (INT, PK, AUTO_INCREMENT)</code>: M√£ ƒë·ªãnh danh duy nh·∫•t cho ng∆∞·ªùi d√πng.</li>
    <li><code>username (VARCHAR(50), UNIQUE, NOT NULL)</code>: T√™n ƒëƒÉng nh·∫≠p duy nh·∫•t c·ªßa ng∆∞·ªùi d√πng.</li>
    <li><code>email (VARCHAR(100), UNIQUE, NOT NULL)</code>: ƒê·ªãa ch·ªâ email duy nh·∫•t ƒë·ªÉ li√™n h·ªá v√† ƒëƒÉng nh·∫≠p.</li>
    <li><code>password_hash (VARCHAR(255), NOT NULL)</code>: M·∫≠t kh·∫©u ƒë√£ m√£ h√≥a ƒë·ªÉ b·∫£o m·∫≠t t√†i kho·∫£n.</li>
    <li><code>full_name (VARCHAR(100), NOT NULL)</code>: H·ªç v√† t√™n ƒë·∫ßy ƒë·ªß c·ªßa ng∆∞·ªùi d√πng.</li>
    <li><code>is_active (BOOLEAN, DEFAULT TRUE)</code>: Tr·∫°ng th√°i ho·∫°t ƒë·ªông c·ªßa t√†i kho·∫£n.</li>
    <li><code>created_at (TIMESTAMP, DEFAULT CURRENT_TIMESTAMP)</code>: Th·ªùi gian t·∫°o t√†i kho·∫£n.</li>
    <li><code>updated_at (TIMESTAMP, DEFAULT CURRENT_TIMESTAMP ON UPDATE)</code>: Th·ªùi gian c·∫≠p nh·∫≠t th√¥ng tin g·∫ßn nh·∫•t.</li>
</ul>
<p><strong>Ch·ªâ m·ª•c:</strong> <code>idx_users_email</code>, <code>idx_users_username</code> ƒë·ªÉ t·ªëi ∆∞u t√¨m ki·∫øm theo email v√† username.</p>

<h3>üìö B·∫£ng categories - Ph√¢n lo·∫°i Ch·ªß ƒë·ªÅ</h3>
<p>Ph√¢n lo·∫°i c√°c b√†i ki·ªÉm tra theo ch·ªß ƒë·ªÅ (v√≠ d·ª•: To√°n h·ªçc, Khoa h·ªçc).</p>
<ul>
    <li><code>id (INT, PK, AUTO_INCREMENT)</code>: M√£ ƒë·ªãnh danh duy nh·∫•t cho danh m·ª•c.</li>
    <li><code>name (VARCHAR(100), UNIQUE, NOT NULL)</code>: T√™n danh m·ª•c (v√≠ d·ª•: "Gi√°o d·ª•c").</li>
    <li><code>description (TEXT)</code>: M√¥ t·∫£ chi ti·∫øt v·ªÅ danh m·ª•c (t√πy ch·ªçn).</li>
</ul>
<p><strong>Ch·ªâ m·ª•c:</strong> <code>idx_categories_name</code> ƒë·ªÉ t·ªëi ∆∞u t√¨m ki·∫øm theo t√™n danh m·ª•c.</p>

<h3>üìÇ B·∫£ng uploaded_files - Qu·∫£n l√Ω T·ªáp t·∫£i l√™n</h3>
<p>L∆∞u tr·ªØ th√¥ng tin v·ªÅ c√°c t·ªáp (PDF, DOCX) do ng∆∞·ªùi d√πng t·∫£i l√™n ƒë·ªÉ t·∫°o b√†i ki·ªÉm tra.</p>
<ul>
    <li><code>id (INT, PK, AUTO_INCREMENT)</code>: M√£ ƒë·ªãnh danh duy nh·∫•t cho t·ªáp.</li>
    <li><code>user_id (INT, NOT NULL, FK)</code>: ID c·ªßa ng∆∞·ªùi d√πng t·∫£i l√™n t·ªáp, li√™n k·∫øt v·ªõi b·∫£ng <code>users</code>.</li>
    <li><code>original_filename (VARCHAR(255), NOT NULL)</code>: T√™n g·ªëc c·ªßa t·ªáp.</li>
    <li><code>stored_filename (VARCHAR(255), NOT NULL)</code>: T√™n t·ªáp ƒë∆∞·ª£c l∆∞u tr√™n server.</li>
    <li><code>file_path (VARCHAR(500), NOT NULL)</code>: ƒê∆∞·ªùng d·∫´n l∆∞u tr·ªØ t·ªáp tr√™n server.</li>
    <li><code>file_size (BIGINT, NOT NULL)</code>: K√≠ch th∆∞·ªõc t·ªáp (byte).</li>
    <li><code>file_type (VARCHAR(50), NOT NULL)</code>: Lo·∫°i t·ªáp (v√≠ d·ª•: "pdf").</li>
    <li><code>mime_type (VARCHAR(100), NOT NULL)</code>: ƒê·ªãnh d·∫°ng MIME c·ªßa t·ªáp.</li>
    <li><code>upload_date (TIMESTAMP, DEFAULT CURRENT_TIMESTAMP)</code>: Th·ªùi gian t·∫£i l√™n.</li>
    <li><code>is_processed (BOOLEAN, DEFAULT FALSE)</code>: Tr·∫°ng th√°i x·ª≠ l√Ω b·ªüi AI.</li>
    <li><code>processed_content (LONGTEXT)</code>: N·ªôi dung vƒÉn b·∫£n ƒë∆∞·ª£c AI tr√≠ch xu·∫•t t·ª´ t·ªáp.</li>
    <li><code>is_public (BOOLEAN, DEFAULT FALSE)</code>: T·ªáp c√≥ ƒë∆∞·ª£c c√¥ng khai kh√¥ng.</li>
    <li><code>allow_reuse (BOOLEAN, DEFAULT TRUE)</code>: Cho ph√©p ng∆∞·ªùi d√πng kh√°c t√°i s·ª≠ d·ª•ng t·ªáp.</li>
    <li><code>content_embedding (LONGTEXT)</code>: Vector embedding c·ªßa n·ªôi dung t·ªáp.</li>
    <li><code>embedding_updated_at (TIMESTAMP)</code>: Th·ªùi gian c·∫≠p nh·∫≠t embedding g·∫ßn nh·∫•t.</li>
</ul>
<p><strong>Ch·ªâ m·ª•c:</strong> <code>idx_uploaded_files_user</code>, <code>idx_uploaded_files_is_public</code>, <code>idx_uploaded_files_embedding_updated</code>.</p>

<h3>üìù B·∫£ng quizzes - Qu·∫£n l√Ω B√†i ki·ªÉm tra</h3>
<p>L∆∞u tr·ªØ th√¥ng tin v·ªÅ c√°c b√†i ki·ªÉm tra (quiz) trong h·ªá th·ªëng.</p>
<ul>
    <li><code>id (INT, PK, AUTO_INCREMENT)</code>: M√£ ƒë·ªãnh danh duy nh·∫•t.</li>
    <li><code>creator_id (INT, NOT NULL, FK)</code>: ID ng∆∞·ªùi t·∫°o, li√™n k·∫øt v·ªõi b·∫£ng <code>users</code>.</li>
    <li><code>category_id (INT, FK)</code>: ID danh m·ª•c, li√™n k·∫øt v·ªõi b·∫£ng <code>categories</code>.</li>
    <li><code>title (VARCHAR(255), NOT NULL)</code>: Ti√™u ƒë·ªÅ b√†i ki·ªÉm tra.</li>
    <li><code>description (TEXT)</code>: M√¥ t·∫£ b√†i ki·ªÉm tra.</li>
    <li><code>summary (TEXT)</code>: T√≥m t·∫Øt n·ªôi dung do AI t·∫°o ra.</li>
    <li><code>source_type (ENUM('FILE', 'TEXT'), NOT NULL)</code>: Lo·∫°i ngu·ªìn t·∫°o b√†i ki·ªÉm tra.</li>
    <li><code>file_id (INT, FK)</code>: ID t·ªáp, li√™n k·∫øt v·ªõi b·∫£ng <code>uploaded_files</code>.</li>
    <li><code>questions (List&lt;Question&gt;)</code>: Danh s√°ch c√¢u h·ªèi, li√™n k·∫øt v·ªõi b·∫£ng <code>questions</code>.</li>
</ul>
<p><strong>Ch·ªâ m·ª•c:</strong> <code>idx_quizzes_creator</code>, <code>idx_quizzes_category</code>, <code>idx_quizzes_share_link</code>.</p>

<h3>‚ùì B·∫£ng questions - Qu·∫£n l√Ω C√¢u h·ªèi</h3>
<p>L∆∞u tr·ªØ c√°c c√¢u h·ªèi thu·ªôc c√°c b√†i ki·ªÉm tra.</p>
<ul>
    <li><code>id (INT, PK, AUTO_INCREMENT)</code>: M√£ ƒë·ªãnh danh duy nh·∫•t.</li>
    <li><code>quiz_id (INT, NOT NULL, FK)</code>: ID b√†i ki·ªÉm tra, li√™n k·∫øt v·ªõi b·∫£ng <code>quizzes</code>.</li>
    <li><code>question_text (TEXT, NOT NULL)</code>: N·ªôi dung c√¢u h·ªèi.</li>
    <li><code>question_type (ENUM('MULTIPLE_CHOICE', 'MULTIPLE_SELECT', 'TRUE_FALSE', 'SHORT_ANSWER'), NOT NULL)</code>: Lo·∫°i c√¢u h·ªèi.</li>
    <li><code>points (INT, DEFAULT 1000)</code>: S·ªë ƒëi·ªÉm cho c√¢u h·ªèi.</li>
    <li><code>order_index (INT, NOT NULL)</code>: Th·ª© t·ª± hi·ªÉn th·ªã c√¢u h·ªèi.</li>
    <li><code>time_limit (INT)</code>: Th·ªùi gian gi·ªõi h·∫°n cho c√¢u h·ªèi (gi√¢y).</li>
    <li><code>answers (List&lt;Answer&gt;)</code>: Danh s√°ch ƒë√°p √°n, li√™n k·∫øt v·ªõi b·∫£ng <code>answers</code>.</li>
</ul>
<p><strong>Ch·ªâ m·ª•c:</strong> <code>idx_questions_quiz</code>, <code>idx_questions_order</code>.</p>

<h3>‚úÖ B·∫£ng answers - Qu·∫£n l√Ω ƒê√°p √°n</h3>
<p>L∆∞u tr·ªØ c√°c ƒë√°p √°n cho c√°c c√¢u h·ªèi.</p>
<ul>
    <li><code>id (INT, PK, AUTO_INCREMENT)</code>: M√£ ƒë·ªãnh danh duy nh·∫•t.</li>
    <li><code>question_id (INT, NOT NULL, FK)</code>: ID c√¢u h·ªèi, li√™n k·∫øt v·ªõi b·∫£ng <code>questions</code>.</li>
    <li><code>answer_text (TEXT, NOT NULL)</code>: N·ªôi dung ƒë√°p √°n.</li>
    <li><code>is_correct (BOOLEAN, DEFAULT FALSE)</code>: ƒê√°p √°n c√≥ ƒë√∫ng kh√¥ng.</li>
    <li><code>order_index (INT, NOT NULL)</code>: Th·ª© t·ª± hi·ªÉn th·ªã ƒë√°p √°n.</li>
    <li><code>created_at (TIMESTAMP, DEFAULT CURRENT_TIMESTAMP)</code>: Th·ªùi gian t·∫°o.</li>
</ul>
<p><strong>Ch·ªâ m·ª•c:</strong> <code>idx_answers_question</code>.</p>

<h2 id="functions">T·ªïng quan Ch·ª©c nƒÉng Ch√≠nh</h2>
<p>Ki·∫øn tr√∫c database n√†y h·ªó tr·ª£ m·ªôt lo·∫°t c√°c t√≠nh nƒÉng m·∫°nh m·∫Ω v√† th√¥ng minh.</p>
<ul>
    <li><strong>üß† T·∫°o Quiz b·∫±ng AI:</strong> T·ª± ƒë·ªông sinh c√¢u h·ªèi t·ª´ file ho·∫∑c vƒÉn b·∫£n.</li>
    <li><strong>‚öôÔ∏è Linh ho·∫°t & M·ªü r·ªông:</strong> H·ªó tr·ª£ nhi·ªÅu lo·∫°i c√¢u h·ªèi v√† t√πy ch·ªânh linh ho·∫°t.</li>
</ul>

<h2 id="endpoints">Danh s√°ch API Endpoints</h2>
<p>C√°c API ƒë∆∞·ª£c nh√≥m theo ch·ª©c nƒÉng ƒë·ªÉ th·ª±c hi·ªán c√°c ho·∫°t ƒë·ªông tr√™n h·ªá th·ªëng.</p>

<h3>1. Authentication & User</h3>
<ul>
    <li><code>POST /api/auth/register</code> - ƒêƒÉng k√Ω</li>
    <li><code>POST /api/auth/login</code> - ƒêƒÉng nh·∫≠p</li>
    <li><code>GET /api/users/profile</code> - L·∫•y th√¥ng tin c√° nh√¢n</li>
</ul>

<h3>2. File & AI Processing</h3>
<ul>
    <li><code>POST /api/files/upload</code> - T·∫£i file l√™n</li>
    <li><code>GET /api/files</code> - L·∫•y danh s√°ch file</li>
</ul>

<h3>3. Quiz Management</h3>
<ul>
    <li><code>POST /api/quizzes</code> - T·∫°o quiz t·ª´ file</li>
    <li><code>GET /api/quizzes</code> - L·∫•y danh s√°ch quiz</li>
    <li><code>GET /api/quizzes/{id}</code> - L·∫•y chi ti·∫øt quiz</li>
    <li><code>POST /api/quizzes/{id}/publish</code> - Xu·∫•t b·∫£n quiz</li>
</ul>

<h3>4. Questions & Answers</h3>
<ul>
    <li><code>GET /api/quizzes/{quizId}/questions</code> - L·∫•y c√¢u h·ªèi c·ªßa quiz</li>
    <li><code>POST /api/quizzes/{quizId}/questions</code> - Th√™m c√¢u h·ªèi m·ªõi</li>
    <li><code>PUT /api/questions/{id}</code> - C·∫≠p nh·∫≠t c√¢u h·ªèi</li>
    <li><code>POST /api/questions/{qId}/answers</code> - Th√™m ƒë√°p √°n</li>
</ul>

</body>
</html>